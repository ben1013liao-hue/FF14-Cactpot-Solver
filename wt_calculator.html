<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FF14 å¤©æ›¸å¥‡è«‡æ©Ÿç‡è¨ˆç®—å™¨</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #f0f0f0;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        h1 { margin: 0 0 5px 0; color: #d4af37; text-shadow: 2px 2px 4px #000; }
        .subtitle { color: #aaa; margin-bottom: 20px; font-size: 0.9em; }

        /* --- ç‰ˆé¢é…ç½® (Flex) --- */
        .main-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            flex-wrap: wrap;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* --- å·¦å´å°è¦½åˆ— (èˆ‡ä»™äººå¾®å½©ä¸€è‡´) --- */
        .nav-sidebar {
            display: flex;
            flex-direction: column;
            width: 200px;
            gap: 15px;
            padding-top: 55px;
            flex-shrink: 0;
        }
        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background-color: #2a2a4a;
            color: #ccc;
            text-decoration: none;
            border-radius: 10px;
            border: 1px solid #444;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .nav-item:hover {
            background-color: #3a3a5c;
            border-color: #d4af37;
            color: #fff;
            transform: translateX(5px);
        }
        .nav-item.active {
            background: linear-gradient(135deg, #d4af37 0%, #aa8a2a 100%);
            color: #000;
            border-color: #fff;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
        }
        .nav-icon { margin-right: 10px; font-size: 20px; width: 24px; text-align: center; }

        /* --- ä¸­å¤®éŠæˆ²å€ --- */
        .game-area {
            background-color: #2a2a4a;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            max-width: 500px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #444;
        }

        .instructions {
            font-size: 0.95em;
            color: #ccc;
            margin-bottom: 20px;
            text-align: center;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 8px;
            width: 100%;
        }

        /* --- æ ¼å­æ¨£å¼ (ä¿®æ­£å¤§å°è·³å‹•å•é¡Œ) --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .cell {
            /* å¼·åˆ¶å›ºå®šå¤§å°ï¼Œé˜²æ­¢è¢«æ’é–‹ */
            width: 70px;
            height: 70px;
            background-color: #3a3a5c;
            border: 2px solid #555; /* é è¨­é‚Šæ¡†å¯¬åº¦ */
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            transition: background-color 0.2s, border-color 0.2s, box-shadow 0.2s;
            position: relative;
        }
        .cell:hover { background-color: #4a4a6c; border-color: #888; }
        
        /* æ¿€æ´»ç‹€æ…‹ï¼šåªæ”¹è®Šé¡è‰²èˆ‡å…‰æšˆï¼Œä¸æ”¹è®Š Box Model å¤§å° */
        .cell.active {
            background-color: #fdf5e6; 
            border-color: #d4af37; /* å¯¬åº¦ä¿æŒ 2pxï¼Œåªè®Šè‰² */
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.6); /* ä½¿ç”¨å…‰æšˆå¢åŠ è¦–è¦ºå¼·èª¿ï¼Œä¸ä½”ç©ºé–“ */
        }
        .cell.active::after {
            content: 'â˜…';
            color: #d4af37;
            font-size: 1.2em;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
        }

        /* --- æ§åˆ¶æŒ‰éˆ• --- */
        .controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 10px;
        }
        .btn-reset { 
            background-color: #c62828; color: white; border: none; 
            padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: bold; 
            transition: all 0.2s;
        }
        .btn-reset:hover { background-color: #e53935; transform: scale(1.05); }

        /* --- çµæœé¢æ¿ --- */
        .results-panel {
            width: 100%;
            background-color: #222;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #777;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 1.1em;
            padding-bottom: 5px;
            border-bottom: 1px solid #333;
        }
        .result-item:last-child { border-bottom: none; }
        .percent { font-weight: bold; font-family: monospace; font-size: 1.2em; }
        .chance-3 { color: #ffd700; }
        .chance-2 { color: #c0c0c0; }
        .chance-1 { color: #cd7f32; }

        /* --- å»ºè­°å€å¡Š --- */
        .recommendation {
            margin-top: 15px;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            border-radius: 8px;
            width: 100%;
            border: 2px solid transparent;
        }
        .rec-shuffle { background: rgba(198, 40, 40, 0.2); border-color: #c62828; color: #ff8a80; }
        .rec-keep-gold { background: rgba(255, 215, 0, 0.15); border-color: #ffd700; color: #ffd700; box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
        .rec-keep-silver { background: rgba(192, 192, 192, 0.15); border-color: #c0c0c0; color: #fff; }
        .rec-wait { background-color: #444; color: #aaa; }

        /* --- å³å´è³‡è¨Šå€ (æ–°å¢éœ€æ±‚ 3) --- */
        .info-sidebar {
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-top: 55px;
        }
        .info-card {
            background-color: #2a2a4a;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 20px;
        }
        .info-title {
            color: #d4af37;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid #555;
            padding-bottom: 5px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: #ccc;
        }
        .stat-val { font-weight: bold; color: #fff; }
        .desc-text { font-size: 0.85em; color: #888; margin-top: 5px; line-height: 1.4; }

        /* æ‰‹æ©Ÿç‰ˆ RWD */
        @media (max-width: 900px) {
            .nav-sidebar { 
                width: 100%; flex-direction: row; padding-top: 0; margin-bottom: 10px; justify-content: center;
            }
            .nav-item { flex: 1; justify-content: center; }
            .info-sidebar { width: 100%; padding-top: 0; }
        }
        @media (max-width: 400px) {
            .cell { width: 60px; height: 60px; font-size: 1.5em; }
        }
    </style>
</head>
<body>

    <div class="main-container">
        
        <div class="nav-sidebar">
            <h3 style="text-align:center; color:#888; margin:0 0 10px 0; font-size:14px;">å·¥å…·åˆ—è¡¨</h3>
            
            <a href="index.html" class="nav-item">
                <span class="nav-icon">ğŸŒµ</span>
                <span>ä»™äººå¾®å½©</span>
            </a>

            <a href="#" class="nav-item active">
                <span class="nav-icon">ğŸ“–</span>
                <span>å¤©æ›¸å¥‡è«‡</span>
            </a>
        </div>

        <div class="game-area">
            <h1>å¤©æ›¸å¥‡è«‡æ¨¡æ“¬å™¨</h1>
            <div class="subtitle">é»æ“Šæ ¼å­æ”¾ç½®è²¼ç´™ï¼Œç³»çµ±å°‡è¨ˆç®—å‰©é¤˜æ©Ÿç‡</div>

            <div class="instructions">
                è«‹ä¾ç…§éŠæˆ²ä¸­çš„ä½ç½®é»é¸ï¼Œè¼¸å…¥ç›®å‰çš„ 7~9 å€‹è²¼ç´™ã€‚
            </div>

            <div class="grid" id="grid">
                </div>

            <div class="controls">
                <span id="sticker-count" style="font-weight:bold; color:#d4af37;">å·²è²¼: 0 / 9</span>
                <button class="btn-reset" onclick="resetGrid()">é‡ç½®ç›¤é¢</button>
            </div>

            <div class="results-panel">
                <div class="result-item chance-3">
                    <span>3 æ¢é€£ç·š (é‡‘ç):</span>
                    <span class="percent" id="prob-3">0%</span>
                </div>
                <div class="result-item chance-2">
                    <span>2 æ¢é€£ç·š (éŠ€ç):</span>
                    <span class="percent" id="prob-2">0%</span>
                </div>
                <div class="result-item chance-1">
                    <span>1 æ¢é€£ç·š (éŠ…ç):</span>
                    <span class="percent" id="prob-1">0%</span>
                </div>
            </div>

            <div id="recommendation" class="recommendation rec-wait">
                è«‹æ”¾ç½®è²¼ç´™...
            </div>
        </div>

        <div class="info-sidebar">
            <div class="info-card">
                <div class="info-title">ğŸ“Š åŸºç¤æ©Ÿç‡åƒè€ƒ</div>
                <div class="desc-text" style="margin-bottom:15px;">
                    é€™æ˜¯å¾ 0 é–‹å§‹éš¨æ©Ÿè²¼ 9 å€‹è²¼ç´™çš„æ•¸å­¸ç†è«–æ©Ÿç‡ (C16å–9)ã€‚
                </div>
                
                <div class="stat-row">
                    <span class="chance-3">â˜… 3 æ¢é€£ç·š</span>
                    <span class="stat-val">0.21%</span>
                </div>
                <div class="desc-text">æ¥µä½æ©Ÿç‡å¤§ç (ç´„ 1/476)ã€‚</div>
                <hr style="border:0; border-top:1px solid #444; margin:10px 0;">

                <div class="stat-row">
                    <span class="chance-2">â˜… 2 æ¢é€£ç·š</span>
                    <span class="stat-val">3.57%</span>
                </div>
                <div class="desc-text">é€šå¸¸æŒ‡ã€Œå‰›å¥½ã€2æ¢ç·šã€‚</div>
                <hr style="border:0; border-top:1px solid #444; margin:10px 0;">

                <div class="stat-row">
                    <span class="chance-1">â˜… 1 æ¢é€£ç·š</span>
                    <span class="stat-val">32.31%</span>
                </div>
                <hr style="border:0; border-top:1px solid #444; margin:10px 0;">

                <div class="stat-row">
                    <span style="color:#888;">0 æ¢é€£ç·š</span>
                    <span class="stat-val">63.92%</span>
                </div>
            </div>
        </div>

    </div>

    <script>
        // åˆå§‹åŒ– 4x4 ç¶²æ ¼ç‹€æ…‹ (0: ç©º, 1: æœ‰è²¼ç´™)
        let gridState = new Array(16).fill(0);
        
        // å®šç¾©æ‰€æœ‰å¯èƒ½çš„é€£ç·š (ç´¢å¼•)
        const lines = [
            [0, 1, 2, 3], [4, 5, 6, 7], [8, 9, 10, 11], [12, 13, 14, 15], // æ©«ç·š
            [0, 4, 8, 12], [1, 5, 9, 13], [2, 6, 10, 14], [3, 7, 11, 15], // ç›´ç·š
            [0, 5, 10, 15], [3, 6, 9, 12] // å°è§’ç·š
        ];

        // ç”¢ç”Ÿç¶²æ ¼ UI
        const gridElement = document.getElementById('grid');
        for (let i = 0; i < 16; i++) {
            let cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.index = i;
            cell.onclick = () => toggleCell(i);
            gridElement.appendChild(cell);
        }

        function toggleCell(index) {
            const currentCount = gridState.filter(x => x === 1).length;
            
            if (gridState[index] === 0 && currentCount >= 9) {
                return;
            }

            gridState[index] = gridState[index] === 0 ? 1 : 0;
            renderGrid();
            calculateProbabilities();
        }

        function resetGrid() {
            gridState.fill(0);
            renderGrid();
            calculateProbabilities();
        }

        function renderGrid() {
            const cells = document.querySelectorAll('.cell');
            let count = 0;
            cells.forEach((cell, i) => {
                if (gridState[i] === 1) {
                    cell.classList.add('active');
                    count++;
                } else {
                    cell.classList.remove('active');
                }
            });
            document.getElementById('sticker-count').innerText = `å·²è²¼: ${count} / 9`;
        }

        // æ ¸å¿ƒè¨ˆç®—é‚è¼¯
        function calculateProbabilities() {
            const currentStickers = gridState.filter(x => x === 1).length;
            const emptyIndices = gridState.map((val, idx) => val === 0 ? idx : -1).filter(idx => idx !== -1);
            const remainingStickers = 9 - currentStickers;

            let prob3 = 0, prob2 = 0, prob1 = 0;
            let recText = "è«‹æ”¾ç½®è²¼ç´™...";
            let recClass = "rec-wait";

            // è¶…é 7 å€‹è²¼ç´™ï¼Œæˆ–è€…è²¼æ»¿ 9 å€‹
            if (currentStickers > 7) {
                if (currentStickers === 9) {
                    const linesCount = countLines(gridState);
                    updateUI(linesCount >= 3 ? 100 : 0, linesCount >= 2 ? 100 : 0, linesCount >= 1 ? 100 : 0, "å·²å®Œæˆ", "rec-wait");
                } else {
                    updateUI(0, 0, 0, "ç„¡æ³•æ´—ç‰Œ (å·²è¶…é 7 å¼µ)", "rec-wait");
                }
                return;
            }

            // å°‘æ–¼ 7 å€‹è²¼ç´™
            if (currentStickers < 7) {
                updateUI(0, 0, 0, `è«‹ç¹¼çºŒè²¼è‡³ 7 å€‹è²¼ç´™ (${7 - currentStickers} left)`, "rec-wait");
                return;
            }

            // === å‰›å¥½ 7 å€‹è²¼ç´™ï¼šç­–ç•¥æ ¸å¿ƒ ===
            // è¨ˆç®—çµ„åˆ (çª®èˆ‰æ³•) C(9, 2) = 36 ç¨®
            const combinations = getCombinations(emptyIndices, remainingStickers);
            const totalCombos = combinations.length;
            
            let count3 = 0, count2 = 0, count1 = 0;

            combinations.forEach(combo => {
                let tempGrid = [...gridState];
                combo.forEach(idx => tempGrid[idx] = 1);
                
                let l = countLines(tempGrid);
                if (l >= 3) count3++;
                if (l >= 2) count2++; // é€™è£¡çš„2ç·šåŒ…å«3ç·šçš„æƒ…æ³
                if (l >= 1) count1++;
            });

            prob3 = (count3 / totalCombos) * 100;
            prob2 = (count2 / totalCombos) * 100; // æ­¤æ©Ÿç‡åŒ…å«3ç·š
            prob1 = (count1 / totalCombos) * 100;

            // === éœ€æ±‚ 4ï¼šå„ªåŒ–å¾Œçš„å»ºè­°é‚è¼¯ ===
            // é‚è¼¯èªªæ˜ï¼š
            // 1. é‡‘çå„ªå…ˆï¼šåªè¦æœ‰ 3 ç·šæ©Ÿæœƒ (prob3 > 0)ï¼Œå»ºè­°ä¿ç•™ï¼Œå› ç‚º shuffle ä»£åƒ¹ä½ä½† gold åƒ¹å€¼æ¥µé«˜ã€‚
            // 2. éŠ€çä¿åº•ï¼šå¦‚æœ 3 ç·šç„¡æœ› (prob3 == 0)ï¼Œæª¢æŸ¥ 2 ç·šæ©Ÿç‡ã€‚
            //    - å¦‚æœ 2 ç·šæ©Ÿç‡é«˜ (ä¾‹å¦‚ > 40%)ï¼Œå»ºè­°ä¿ç•™æ‹šéŠ€çã€‚
            //    - å¦‚æœ 2 ç·šæ©Ÿç‡ä½ï¼Œå»ºè­°æ´—ç‰Œã€‚

            if (prob3 > 0) {
                recText = "âœ¨ å»ºè­°ä¿ç•™ï¼(æœ‰æ©Ÿç‡ä¸­é‡‘ç)";
                recClass = "rec-keep-gold";
            } else {
                // 3 ç·šæ©Ÿç‡ç‚º 0ï¼Œçœ‹éŠ€ç
                // è¨­å®šé–¥å€¼ï¼š40% ä»¥ä¸Šå‹ç‡ç®—é«˜ï¼Œå€¼å¾—æ‹š
                if (prob2 >= 40) {
                    recText = "âœ… å»ºè­°ä¿ç•™ (ç©©æ‹¿éŠ€ç)";
                    recClass = "rec-keep-silver";
                } else if (prob2 >= 15) {
                    recText = "ğŸ¤” å¯è€ƒæ…® (éŠ€çæ©Ÿç‡æ™®é€š)";
                    recClass = "rec-wait"; // ç°è‰²ä¸­ç«‹å»ºè­°
                } else {
                    recText = "ğŸ”„ å»ºè­°æ´—ç‰Œ (çˆ›ç›¤é¢)";
                    recClass = "rec-shuffle";
                }
            }

            updateUI(prob3, prob2, prob1, recText, recClass);
        }

        function updateUI(p3, p2, p1, recText, recClass) {
            document.getElementById('prob-3').innerText = formatPercent(p3);
            document.getElementById('prob-2').innerText = formatPercent(p2);
            document.getElementById('prob-1').innerText = formatPercent(p1);
            
            const recEl = document.getElementById('recommendation');
            recEl.innerText = recText;
            recEl.className = "recommendation " + recClass;
        }

        function formatPercent(num) {
            if (num === 0) return "0%";
            if (num === 100) return "100%";
            return num.toFixed(2) + "%";
        }

        // è¨ˆç®—ç›¤é¢æœ‰å¹¾æ¢ç·š
        function countLines(grid) {
            let count = 0;
            for (let line of lines) {
                if (line.every(idx => grid[idx] === 1)) {
                    count++;
                }
            }
            return count;
        }

        // çµ„åˆç”Ÿæˆå‡½æ•¸ C(n, k)
        function getCombinations(array, k) {
            let result = [];
            function helper(start, combo) {
                if (combo.length === k) {
                    result.push([...combo]);
                    return;
                }
                for (let i = start; i < array.length; i++) {
                    combo.push(array[i]);
                    helper(i + 1, combo);
                    combo.pop();
                }
            }
            helper(0, []);
            return result;
        }
    </script>
</body>
</html>